Sub stockmarket()

For Each ws In Worksheets
    ws.Activate
    
   'define last row'
   LastRow = Cells(Rows.Count, 1).End(xlUp).Row
   
   'define everything'
   Dim TickerRow As Integer
        TickerRow = 2
        
   Dim Volume As Double
        Volume = 0
        
    Dim YearlyChange As Double
        
   Dim OpenPrice As Double
        OpenPrice = Cells(2, 3).Value
   
   'Name new columns'
        Range("I1").Value = "Ticker"
        Range("J1").Value = "Yearly Change"
        Range("K1").Value = "Percent Change"
        Range("L1").Value = "Total Stock Volume"
   
   'Begin forloop'
   
        For i = 2 To LastRow
        Volume = Volume + Cells(i, 7).Value
    
    'Populate Ticker and Volume'
    
            If Cells(i + 1, 1).Value <> Cells(i, 1).Value Then
                Cells(TickerRow, 9).Value = Cells(i, 1).Value
                Cells(TickerRow, 12).Value = Volume
                
    'Calculate Yearly Change'
            
            ClosingPrice = Cells(i, 6).Value
            YearlyChange = (ClosingPrice - OpenPrice)
                Cells(TickerRow, 10).Value = YearlyChange
                
    'Calculate Percent Change'
    
                    If OpenPrice = 0 Then
                            PercentChange = 0
                    Else
                            PercentChange = (YearlyChange / OpenPrice)
                    
                    End If
            
            Cells(TickerRow, 11).Value = PercentChange
            
            Range("K2:K" & LastRow).NumberFormat = "0.00%"
                    
                                   
   'Reset Values'
   
                Volume = 0
            
                TickerRow = TickerRow + 1
                
                OpenPrice = Cells(i + 1, 3)
        
            End If
                
        
Next i
        
 'Set last row for summary columns'
 LastRow = Cells(Rows.Count, 9).End(xlUp).Row
 
 'Set Conditional Formatting'
 
        For i = 2 To LastRow
        
        If Cells(i, 10).Value > 0 Then
        
                Cells(i, 10).Interior.ColorIndex = 4
                
        Else
                Cells(i, 10).Interior.ColorIndex = 3
                
        End If
        
Next i

Next ws

End Sub

